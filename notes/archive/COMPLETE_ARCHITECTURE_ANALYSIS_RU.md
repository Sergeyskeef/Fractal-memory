# üéØ –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–†–•–ò–¢–ï–ö–¢–£–†–´ FRACTAL MEMORY

**–î–∞—Ç–∞:** 2025-12-06  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞

---

## üèóÔ∏è –†–ï–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–°)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FRACTAL MEMORY SYSTEM                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  L0 (Episodic) - REDIS                                       ‚îÇ
‚îÇ  ‚îî‚îÄ> –ö–ª—é—á–∏: memory:{user}:l0:*                              ‚îÇ
‚îÇ      –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö (–≤–æ–∑–º–æ–∂–Ω–æ –æ—á–∏—â–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ)                 ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  L1 (ShortTerm) - REDIS ‚úÖ –ù–ê–ô–î–ï–ù–û!                         ‚îÇ
‚îÇ  ‚îî‚îÄ> –ö–ª—é—á–∏: memory:{user}:l1:session:{id}                   ‚îÇ
‚îÇ      135 –∫–ª—é—á–µ–π –Ω–∞–π–¥–µ–Ω–æ                                      ‚îÇ
‚îÇ      –ü–æ–ª—è: session_id, summary, importance, source_count,    ‚îÇ
‚îÇ             source_ids, created_at, promoted_to_l2           ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  L2 (Entity) - NEO4J ‚úÖ                                      ‚îÇ
‚îÇ  ‚îî‚îÄ> –ú–µ—Ç–∫–∞: Entity (65 —É–∑–ª–æ–≤)                               ‚îÇ
‚îÇ      –ú–µ—Ç–∫–∞: Episodic (149 —É–∑–ª–æ–≤) - –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —ç–ø–∏–∑–æ–¥–∏–∫–∞   ‚îÇ
‚îÇ      –°–≤—è–∑—å: (Episodic)-[:MENTIONS]->(Entity)                ‚îÇ
‚îÇ      –°–≤—è–∑—å: (Entity)-[:RELATES_TO]->(Entity)                ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  L3 (Learning) - NEO4J ‚úÖ                                    ‚îÇ
‚îÇ  ‚îî‚îÄ> –ú–µ—Ç–∫–∞: Strategy (43 —É–∑–ª–∞)                              ‚îÇ
‚îÇ      –ú–µ—Ç–∫–∞: Experience (93 —É–∑–ª–∞)                             ‚îÇ
‚îÇ      –°–≤—è–∑—å: (Experience)-[:USED_STRATEGY]->(Strategy)       ‚îÇ
‚îÇ                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚úÖ –ß–¢–û –ù–ê–ô–î–ï–ù–û

### REDIS (L0/L1):
- ‚úÖ **135 –∫–ª—é—á–µ–π L1** - `memory:{user}:l1:session:{id}`
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ L1:
  ```python
  {
      'session_id': '1764861796648-0',
      'summary': 'Searchable content',
      'importance': 0.777,
      'source_count': 1,
      'source_ids': ['1764861796648-0'],
      'created_at': '2025-12-05T04:09:25.978738',
      'promoted_to_l2': False
  }
  ```
- ‚ö†Ô∏è **L0 –∫–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã** - –≤–æ–∑–º–æ–∂–Ω–æ –æ—á–∏—â–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ

### NEO4J (L2/L3):
- ‚úÖ **Episodic** - 149 —É–∑–ª–æ–≤ (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —ç–ø–∏–∑–æ–¥–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å)
- ‚úÖ **Entity** - 65 —É–∑–ª–æ–≤ (—Å—É—â–Ω–æ—Å—Ç–∏ Graphiti)
- ‚úÖ **Strategy** - 43 —É–∑–ª–∞ (—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—É—á–µ–Ω–∏—è)
- ‚úÖ **Experience** - 93 —É–∑–ª–∞ (–æ–ø—ã—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π)
- ‚úÖ **46 –∏–Ω–¥–µ–∫—Å–æ–≤** (–≤–∫–ª—é—á–∞—è vector index!)
- ‚úÖ **4 unique constraints**

---

## üîÑ –ü–û–¢–û–ö –î–ê–ù–ù–´–• (–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### 1. –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
User Message
    ‚Üì
L0 (Redis) - memory:{user}:l0:*
    ‚Üì (–±—ã—Å—Ç—Ä–æ –æ—á–∏—â–∞–µ—Ç—Å—è)
L1 (Redis) - memory:{user}:l1:session:{id}
    ‚Üì (consolidation –ø—Ä–∏ importance > threshold)
L2 (Neo4j) - Episodic + Entity (—á–µ—Ä–µ–∑ Graphiti)
    ‚Üì (extraction)
L2 (Neo4j) - Entity (—Å—É—â–Ω–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏)
```

### 2. –û–±—É—á–µ–Ω–∏–µ:
```
Agent Action
    ‚Üì
Experience (Neo4j)
    ‚Üì USED_STRATEGY
Strategy (Neo4j)
    ‚Üì (update success_rate)
Strategy (updated)
```

### 3. –ü–æ–∏—Å–∫:
```
Query
    ‚Üì
‚îú‚îÄ> L1 (Redis) - keyword search
‚îú‚îÄ> L2 (Neo4j) - vector search (Entity.embedding)
‚îú‚îÄ> L2 (Neo4j) - fulltext search (Episodic.content)
‚îî‚îÄ> L2 (Neo4j) - graph search (RELATES_TO)
    ‚Üì
RRF Fusion
    ‚Üì
Results
```

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### Redis:
- **L1 –∫–ª—é—á–∏:** 135
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:** test_user, sergey
- **–§–æ—Ä–º–∞—Ç:** Hash (7 –ø–æ–ª–µ–π)

### Neo4j:
- **–í—Å–µ–≥–æ —É–∑–ª–æ–≤:** 352
- **–í—Å–µ–≥–æ —Å–≤—è–∑–µ–π:** 633
- **–ò–Ω–¥–µ–∫—Å–æ–≤:** 46
- **Constraints:** 4

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –º–µ—Ç–∫–∞–º:
| –ú–µ—Ç–∫–∞ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|------------|------------|
| Episodic | 149 | –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —ç–ø–∏–∑–æ–¥–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å |
| Entity | 65 | –°—É—â–Ω–æ—Å—Ç–∏ (Graphiti) |
| Experience | 93 | –û–ø—ã—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π |
| Strategy | 43 | –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—É—á–µ–Ω–∏—è |
| Migration | 2 | –°–ª—É–∂–µ–±–Ω–∞—è |
| Community | 0 | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
| Episode | 0 | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–´ –ê–£–î–ò–¢–ê

### –ê—É–¥–∏—Ç –æ–∂–∏–¥–∞–ª –ù–ï–ü–†–ê–í–ò–õ–¨–ù–£–Æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:

#### –û–∂–∏–¥–∞–ª–æ—Å—å:
```python
# –í Neo4j:
expected_labels = {
    'Episodic',      # L0
    'ShortTerm',     # L1 ‚ùå –ù–ï–¢ –í NEO4J
    'Entity',        # L2
    'Strategy',      # L3
    'Experience',    # L3
}

expected_relationships = [
    ('Episodic', 'CONSOLIDATED_TO', 'ShortTerm'),  # ‚ùå –ù–ï–¢
    ('ShortTerm', 'EXTRACTED_TO', 'Entity'),       # ‚ùå –ù–ï–¢
    ('Entity', 'RELATES_TO', 'Entity'),            # ‚úÖ –ï–°–¢–¨
    ('Strategy', 'APPLIED_IN', 'Experience'),      # ‚ùå –û–ë–†–ê–¢–ù–ê–Ø
    ('Experience', 'REFERENCES', 'Entity'),        # ‚ùå –ù–ï–¢
]
```

#### –†–µ–∞–ª—å–Ω–æ:
```python
# L1 –≤ Redis, –Ω–µ –≤ Neo4j!
redis_keys = {
    'memory:{user}:l1:session:{id}',  # ‚úÖ L1 –ó–î–ï–°–¨
}

# –í Neo4j:
actual_labels = {
    'Episodic',      # –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —ç–ø–∏–∑–æ–¥–∏–∫–∞
    'Entity',        # Graphiti —Å—É—â–Ω–æ—Å—Ç–∏
    'Strategy',      # –°—Ç—Ä–∞—Ç–µ–≥–∏–∏
    'Experience',    # –û–ø—ã—Ç
}

actual_relationships = [
    ('Episodic', 'MENTIONS', 'Entity'),           # ‚úÖ Graphiti
    ('Entity', 'RELATES_TO', 'Entity'),           # ‚úÖ Graphiti
    ('Experience', 'USED_STRATEGY', 'Strategy'),  # ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
]
```

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –û–±–Ω–æ–≤–∏—Ç—å SchemaValidator:

```python
# audit/checkers/schema_validator.py

# –°–¢–ê–†–´–ô –ö–û–î (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
expected_labels = {
    'Episodic', 'ShortTerm', 'Entity', 'Strategy', 'Experience'
}

# –ù–û–í–´–ô –ö–û–î (–ü–†–ê–í–ò–õ–¨–ù–û):
expected_labels = {
    'Episodic',      # –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —ç–ø–∏–∑–æ–¥–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å –≤ Neo4j
    'Entity',        # –°—É—â–Ω–æ—Å—Ç–∏ Graphiti
    'Strategy',      # –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—É—á–µ–Ω–∏—è
    'Experience',    # –û–ø—ã—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
    # 'Community',   # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (Graphiti communities)
}

# –°–¢–ê–†–´–ô –ö–û–î (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
expected_relationships = [
    ('Episodic', 'CONSOLIDATED_TO', 'ShortTerm'),
    ('ShortTerm', 'EXTRACTED_TO', 'Entity'),
    ...
]

# –ù–û–í–´–ô –ö–û–î (–ü–†–ê–í–ò–õ–¨–ù–û):
expected_relationships = [
    ('Episodic', 'MENTIONS', 'Entity'),           # Graphiti —Å–≤—è–∑—å
    ('Entity', 'RELATES_TO', 'Entity'),           # Graphiti —Å–≤—è–∑—å –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏
    ('Experience', 'USED_STRATEGY', 'Strategy'),  # –°–≤—è–∑—å –æ–ø—ã—Ç–∞ —Å–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π
]
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å MemoryTester:

```python
# audit/testers/memory_tester.py

# –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É L1 –≤ Redis:
async def test_l0_to_l1_consolidation(self):
    """L0‚ÜíL1 –∫–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ Redis."""
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis –∫–ª—é—á–∏
    l1_keys = await self.redis_client.keys("memory:*:l1:*")
    
    if not l1_keys:
        issues.append(self.create_issue(
            title="No L1 keys found in Redis",
            description="Expected memory:{user}:l1:session:{id} keys",
            ...
        ))
```

### 3. –û–±–Ω–æ–≤–∏—Ç—å RetrievalTester:

```python
# audit/testers/retrieval_tester.py

# –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–∏—Å–∫ –≤ Redis L1:
async def test_l0_l1_search(self):
    """–ü–æ–∏—Å–∫ –≤ L1 (Redis)."""
    
    # –ü–æ–ª—É—á–∏—Ç—å L1 –∫–ª—é—á–∏
    l1_keys = await self.redis_client.keys("memory:*:l1:*")
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–æ–∂–µ–º —á–∏—Ç–∞—Ç—å
    for key in l1_keys[:5]:
        data = await self.redis_client.hgetall(key)
        assert 'summary' in data
        assert 'importance' in data
```

---

## üéØ –í–´–í–û–î–´

### ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –†–ê–ë–û–¢–ê–ï–¢:
1. L0/L1 –≤ Redis (–±—ã—Å—Ç—Ä–∞—è –ø–∞–º—è—Ç—å)
2. L2/L3 –≤ Neo4j (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å + –æ–±—É—á–µ–Ω–∏–µ)
3. Graphiti —É–ø—Ä–∞–≤–ª—è–µ—Ç Entity –∏ —Å–≤—è–∑—è–º–∏
4. ReasoningBank —É–ø—Ä–∞–≤–ª—è–µ—Ç Strategy –∏ Experience

### ‚ùå –ê—É–¥–∏—Ç –±—ã–ª –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ú:
1. –û–∂–∏–¥–∞–ª L1 –≤ Neo4j (—Ä–µ–∞–ª—å–Ω–æ –≤ Redis)
2. –û–∂–∏–¥–∞–ª –¥—Ä—É–≥–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–≤—è–∑–µ–π
3. –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª Redis

### ‚úÖ –†–µ—à–µ–Ω–∏–µ:
**–û–±–Ω–æ–≤–∏—Ç—å –∞—É–¥–∏—Ç –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É!**

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `SchemaValidator` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ–∂–∏–¥–∞–Ω–∏—è–º–∏
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `MemoryTester` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Redis L1
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `RetrievalTester` –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ Redis
4. ‚úÖ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∞—É–¥–∏—Ç
5. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–Ω—è—Ç–∞! –¢–µ–ø–µ—Ä—å –º–æ–∂–µ–º –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∞—É–¥–∏—Ç.** üéâ
