# üîç –ê–ù–ê–õ–ò–ó –°–•–ï–ú–´ NEO4J - –†–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–î–∞—Ç–∞:** 2025-12-06  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°—Ö–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞ –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

---

## üìä –†–ï–ê–õ–¨–ù–ê–Ø –°–•–ï–ú–ê

### –ú–µ—Ç–∫–∏ —É–∑–ª–æ–≤ (7 –Ω–∞–π–¥–µ–Ω–æ):
1. ‚úÖ **Episodic** - 149 —É–∑–ª–æ–≤ (—ç–ø–∏–∑–æ–¥–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å L0)
2. ‚úÖ **Entity** - 65 —É–∑–ª–æ–≤ (—Å—É—â–Ω–æ—Å—Ç–∏ L2)
3. ‚úÖ **Strategy** - 43 —É–∑–ª–∞ (—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ L3)
4. ‚úÖ **Experience** - 93 —É–∑–ª–∞ (–æ–ø—ã—Ç L3)
5. ‚ö†Ô∏è **Community** - 0 —É–∑–ª–æ–≤ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
6. ‚ö†Ô∏è **Episode** - 0 —É–∑–ª–æ–≤ (–¥—É–±–ª–∏–∫–∞—Ç Episodic?)
7. ‚úÖ **Migration** - 2 —É–∑–ª–∞ (—Å–ª—É–∂–µ–±–Ω–∞—è)

### –°–≤—è–∑–∏ (4 –Ω–∞–π–¥–µ–Ω–æ):
1. ‚úÖ **RELATES_TO** - —Å–≤—è–∑–∏ –º–µ–∂–¥—É Entity
2. ‚úÖ **MENTIONS** - Episodic ‚Üí Entity
3. ‚ö†Ô∏è **HAS_MEMBER** - Community (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
4. ‚úÖ **USED_STRATEGY** - —Å–≤—è–∑—å —Å–æ Strategy

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢

### 1. –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–∫–∏ –ï–°–¢–¨:
- ‚úÖ `Episodic` (L0) - 149 —É–∑–ª–æ–≤
- ‚úÖ `Entity` (L2) - 65 —É–∑–ª–æ–≤
- ‚úÖ `Strategy` (L3) - 43 —É–∑–ª–∞
- ‚úÖ `Experience` (L3) - 93 —É–∑–ª–∞

### 2. –ò–Ω–¥–µ–∫—Å—ã –û–¢–õ–ò–ß–ù–´–ï (46 –∏–Ω–¥–µ–∫—Å–æ–≤!):
- ‚úÖ Vector index –¥–ª—è Entity.embedding
- ‚úÖ Fulltext indexes –¥–ª—è –ø–æ–∏—Å–∫–∞
- ‚úÖ Range indexes –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ Unique constraints –¥–ª—è id

### 3. –î–∞–Ω–Ω—ã–µ –ï–°–¢–¨:
- 352 —É–∑–ª–∞ –≤—Å–µ–≥–æ
- 633 —Å–≤—è–∑–∏
- –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Sergey)

---

## ‚ùå –ß–¢–û –û–¢–°–£–¢–°–¢–í–£–ï–¢

### 1. –ú–µ—Ç–∫–∞ `ShortTerm` (L1) - –ù–ï –ù–ê–ô–î–ï–ù–ê
**–û–∂–∏–¥–∞–ª–æ—Å—å:** –£–∑–ª—ã –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–π –ø–∞–º—è—Ç–∏ L1  
**–†–µ–∞–ª—å–Ω–æ:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç  
**–í–ª–∏—è–Ω–∏–µ:** –ù–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è L0‚ÜíL1‚ÜíL2

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- Graphiti –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –º–µ—Ç–∫—É –¥–ª—è L1
- L1 –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ Redis (–Ω–µ –≤ Neo4j)
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∑–∞–¥—É–º–∞–Ω–Ω–æ–π

### 2. –°–≤—è–∑—å `CONSOLIDATED_TO` - –ù–ï –ù–ê–ô–î–ï–ù–ê
**–û–∂–∏–¥–∞–ª–æ—Å—å:** Episodic ‚Üí ShortTerm ‚Üí Entity  
**–†–µ–∞–ª—å–Ω–æ:** Episodic ‚Üí Entity (—á–µ—Ä–µ–∑ MENTIONS)

### 3. –°–≤—è–∑—å `EXTRACTED_TO` - –ù–ï –ù–ê–ô–î–ï–ù–ê
**–û–∂–∏–¥–∞–ª–æ—Å—å:** ShortTerm ‚Üí Entity  
**–†–µ–∞–ª—å–Ω–æ:** –ù–µ –Ω—É–∂–Ω–∞ (–Ω–µ—Ç ShortTerm)

### 4. –°–≤—è–∑—å `APPLIED_IN` - –ù–ï –ù–ê–ô–î–ï–ù–ê
**–û–∂–∏–¥–∞–ª–æ—Å—å:** Strategy ‚Üí Experience  
**–†–µ–∞–ª—å–Ω–æ:** Experience ‚Üí Strategy (—á–µ—Ä–µ–∑ USED_STRATEGY, –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å)

---

## üéØ –†–ï–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–ê–ú–Ø–¢–ò

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –°–ï–ô–ß–ê–°:

```
L0 (Episodic) ‚îÄ‚îÄMENTIONS‚îÄ‚îÄ> L2 (Entity) ‚îÄ‚îÄRELATES_TO‚îÄ‚îÄ> L2 (Entity)
                                                              ‚Üì
L3 (Strategy) <‚îÄ‚îÄUSED_STRATEGY‚îÄ‚îÄ L3 (Experience)
```

### –ö–∞–∫ –ó–ê–î–£–ú–´–í–ê–õ–û–°–¨:

```
L0 (Episodic) ‚îÄ‚îÄCONSOLIDATED_TO‚îÄ‚îÄ> L1 (ShortTerm) ‚îÄ‚îÄEXTRACTED_TO‚îÄ‚îÄ> L2 (Entity)
                                                                           ‚Üì
L3 (Strategy) ‚îÄ‚îÄAPPLIED_IN‚îÄ‚îÄ> L3 (Experience) ‚îÄ‚îÄREFERENCES‚îÄ‚îÄ> L2 (Entity)
```

### –í—ã–≤–æ–¥:
**Graphiti –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–ø—Ä–æ—â–µ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:**
- L0 (Episodic) ‚Üí –Ω–∞–ø—Ä—è–º—É—é ‚Üí L2 (Entity)
- –ù–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ L1 (ShortTerm) –≤ Neo4j
- L1 –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ Redis

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –î–õ–Ø –ê–£–î–ò–¢–ê

### 1. –û–±–Ω–æ–≤–∏—Ç—å –æ–∂–∏–¥–∞–µ–º—ã–µ –º–µ—Ç–∫–∏ –≤ SchemaValidator:

```python
# –°—Ç–∞—Ä—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
expected_labels = {
    'Episodic',      # L0
    'ShortTerm',     # L1 - –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢
    'Entity',        # L2
    'Strategy',      # L3
    'Experience',    # L3
}

# –ù–æ–≤—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è (–ü–†–ê–í–ò–õ–¨–ù–û):
expected_labels = {
    'Episodic',      # L0 - —ç–ø–∏–∑–æ–¥–∏—á–µ—Å–∫–∞—è –ø–∞–º—è—Ç—å
    'Entity',        # L2 - —Å—É—â–Ω–æ—Å—Ç–∏ (Graphiti)
    'Strategy',      # L3 - —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    'Experience',    # L3 - –æ–ø—ã—Ç
    'Community',     # Graphiti communities (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å –æ–∂–∏–¥–∞–µ–º—ã–µ —Å–≤—è–∑–∏:

```python
# –°—Ç–∞—Ä—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
expected_relationships = [
    ('Episodic', 'CONSOLIDATED_TO', 'ShortTerm'),
    ('ShortTerm', 'EXTRACTED_TO', 'Entity'),
    ('Entity', 'RELATES_TO', 'Entity'),
    ('Strategy', 'APPLIED_IN', 'Experience'),
    ('Experience', 'REFERENCES', 'Entity'),
]

# –ù–æ–≤—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è (–ü–†–ê–í–ò–õ–¨–ù–û):
expected_relationships = [
    ('Episodic', 'MENTIONS', 'Entity'),      # Graphiti —Å–≤—è–∑—å
    ('Entity', 'RELATES_TO', 'Entity'),      # Graphiti —Å–≤—è–∑—å
    ('Experience', 'USED_STRATEGY', 'Strategy'),  # –ù–∞—à–∞ —Å–≤—è–∑—å
]
```

### 3. –ü–æ–Ω—è—Ç—å –≥–¥–µ L1 (ShortTerm):

**–ì–∏–ø–æ—Ç–µ–∑–∞:** L1 –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ Redis, –Ω–µ –≤ Neo4j

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
redis-cli
> KEYS l1:*
> KEYS short_term:*
> KEYS *
```

---

## üìù –í–´–í–û–î–´

### –•–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏:
1. ‚úÖ –°—Ö–µ–º–∞ Neo4j –≤ –æ—Ç–ª–∏—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
2. ‚úÖ –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ –º–µ—Å—Ç–µ
3. ‚úÖ Graphiti —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
4. ‚úÖ –î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã

### –ü—Ä–æ–±–ª–µ–º—ã:
1. ‚ùå –ê—É–¥–∏—Ç –æ–∂–∏–¥–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
2. ‚ùå L1 (ShortTerm) –Ω–µ –≤ Neo4j (–≤–æ–∑–º–æ–∂–Ω–æ –≤ Redis)
3. ‚ùå –°–≤—è–∑–∏ –Ω–∞–∑–≤–∞–Ω—ã –ø–æ-–¥—Ä—É–≥–æ–º—É (MENTIONS –≤–º–µ—Å—Ç–æ CONSOLIDATED_TO)

### –†–µ—à–µ–Ω–∏–µ:
**–û–±–Ω–æ–≤–∏—Ç—å –∞—É–¥–∏—Ç –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Graphiti!**

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å `SchemaValidator` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ–∂–∏–¥–∞–Ω–∏—è–º–∏
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis –¥–ª—è L1
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
4. ‚úÖ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∞—É–¥–∏—Ç

---

## üìä –î–ï–¢–ê–õ–ò –£–ó–õ–û–í

### Episodic (L0):
```python
{
    'uuid': '22a6c33b-4b38-4ed8-9231-102d1df00c7d',
    'name': 'ep_sergey_20251204_093940_348605',
    'content': '[user:sergey] User: –ü—Ä–∏–≤–µ—Ç! ...',
    'created_at': '2025-12-04T09:39:40.348684000',
    'source': 'message',
    'source_description': 'direct_save | importance:0.90',
    'entity_edges': ['8ab7cbc1...', 'b6be4c45...'],
    'group_id': '',
}
```

### Entity (L2):
```python
{
    'uuid': '39d167da-b91d-4565-bb1c-6d184899628d',
    'name': 'Sergey',
    'summary': 'The user Sergey is actively engaging...',
    'created_at': '2025-12-04T09:39:43.154894000',
    'name_embedding': [-0.007015716750174761, ...],
    'group_id': '',
}
```

### Strategy (L3):
```python
{
    'id': '86c2496d-f84e-448a-9074-532365aef385',
    'task_type': 'coding',
    'description': 'Use type hints and docstrings',
    'success_rate': 1.0,
    'usage_count': 1,
    'user_id': 'test_user',
    'created_at': '2025-12-04T13:43:37.483000000+00:00',
    'deleted': False,
}
```

### Experience (L3):
```python
{
    'id': 'd504468e-26e8-4ba4-99ad-0591a713b62e',
    'user_id': 'test_user',
    'context': 'Test context',
    'action': 'Test action',
    'outcome': True,
    'created_at': '2025-12-04T13:43:37.860000000+00:00',
    'deleted': False,
}
```

---

**–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü—Ä–æ—Å—Ç–æ –æ–Ω–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –Ω–∞—à–∏—Ö –æ–∂–∏–¥–∞–Ω–∏–π.** üéØ
